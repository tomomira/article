# 【比較】CookieとSessionの違い

Webアプリケーションにおいて、HTTPプロトコルの「ステートレス（状態を保持しない）」という性質を補い、ユーザーの状態を管理するために使われるのが「Cookie」と「Session」です。この2つは密接に関連して動作しますが、**データをどこに保存するか**という点で決定的な違いがあります。

## 概要

| 項目 | Cookie (クッキー) | Session (セッション) |
| --- | --- | --- |
| **データ保存場所** | **クライアント側**（Webブラウザ） | **サーバー側** |
| **保存できるデータ** | 文字列のみ。比較的小容量（約4KB） | サーバーのリソースが許す限り、多様なデータを保存可能 |
| **セキュリティ** | 比較的低い（改ざんや盗聴のリスク） | 比較的高い（実データはサーバー上にある） |
| **パフォーマンス** | サーバー負荷は低いが、リクエスト毎に送信されるため通信量が増える | サーバーに負荷がかかる |
| **有効期限** | 任意に設定可能。ブラウザを閉じても保持できる | 基本的にブラウザを閉じるまで。任意に設定も可能 |
| **役割** | ユーザーを識別するためのIDや、少量の情報を保持する | ユーザーごとの詳細な状態（ログイン情報、カートの中身など）を管理する |

一言で言うと、**Cookieは「ブラウザに貼る小さな名札」** であり、**Sessionは「サーバー側で管理する、その名札に対応した顧客台帳」** のような関係です。

---

## 各技術の詳細

### 1. Cookie (クッキー)

Cookieは、Webサーバーからの指示で、WebブラウザがユーザーのPC内に保存する小さなテキストファイルです。ユーザーが同じサイトを再訪した際、ブラウザは保存しているCookieをサーバーに送信します。サーバーはこれを受け取ることで、以前アクセスしたユーザーであることを識別できます。

#### 主な特徴と用途

- **クライアント側保存**: データはユーザーのブラウザ（PC）に保存されます。
- **データ量の制限**: 1つのCookieに保存できるデータは約4KBと小さく、保存できる数にも制限があります。
- **セキュリティリスク**: テキストデータとして保存されるため、中身を盗み見られたり、改ざんされたりするリスクがあります。そのため、パスワードなどの機密情報を直接保存すべきではありません。
- **主な用途**:
    - Session IDの保持（後述）
    - ログイン状態の維持（「次回から自動的にログインする」機能）
    - ユーザー設定の保存（言語設定、テーマ設定など）
    - 広告配信のためのトラッキング

### 2. Session (セッション)

Sessionは、ユーザーごとの情報をサーバー側で一時的に保持する仕組みです。ユーザーがサイトにアクセスすると、サーバーは各ユーザーを識別するためのユニークな**「Session ID」**を発行します。このIDだけをCookieに保存してブラウザに送り返し、以降の通信ではそのIDを使ってサーバー上のデータとユーザーを結びつけます。

#### 主な特徴と用途

- **サーバー側保存**: ログイン情報やカートの中身といった実データは、サーバーのメモリやデータベースに保存されるため、Cookieより安全です。
- **データ量の柔軟性**: サーバーのリソースに依存するため、Cookieのような厳しい容量制限はありません。
- **セキュリティ**: ブラウザとサーバー間でやり取りされるのはSession IDのみなので、機密情報が漏洩するリスクを低減できます。
- **主な用途**:
    - ログイン状態の管理
    - ECサイトのショッピングカート機能
    - 複数ページにまたがるフォーム入力内容の一時保存

---

## 連携の仕組み（一般的な流れ）

多くのWebアプリケーションでは、CookieとSessionは以下のように連携して動作します。

1.  **初回アクセス**:
    - ユーザーがWebサイトに初めてアクセスする。
    - サーバーがユニークな**Session ID**を生成し、サーバー側でセッション情報を保存する領域を作成する。
    - サーバーは、生成したSession IDを**Cookie**に含めてクライアント（ブラウザ）に送る。

2.  **2回目以降のアクセス**:
    - ブラウザは、リクエストの際にSession IDが書き込まれた**Cookie**を自動的にサーバーへ送信する。
    - サーバーは受け取ったSession IDを元に、サーバー上に保存されているセッション情報を探し出す。
    - サーバーはユーザーを特定し、そのユーザーの状態（ログインしているか、カートに何が入っているか等）に応じたレスポンスを返す。

3.  **セッションの終了**:
    - ユーザーがログアウトするか、ブラウザを閉じると、サーバー上のセッションデータが破棄され、セッションが終了する（設定による）。

このように、Sessionの実態はサーバーにあり、CookieはそのSessionを呼び出すための「鍵」や「合鍵」の役割を果たしているのです。 