# 【比較】コンテナと仮想マシン(VM)の違い

アプリケーションの実行環境を分離・仮想化する技術として、「コンテナ」と「仮想マシン（VM）」は現代のITインフラに欠かせない存在です。どちらもホストOS上で独立した環境を提供しますが、**仮想化するレイヤー**と、それによる**リソース効率**や**起動速度**に大きな違いがあります。

## 概要

| 項目 | コンテナ (Container) | 仮想マシン (Virtual Machine) |
| --- | --- | --- |
| **仮想化の対象** | **OS**（カーネルを共有） | **ハードウェア** |
| **分離レベル** | プロセスレベルの分離 | 完全なOSレベルの分離 |
| **構成要素** | アプリケーション＋ライブラリ/依存関係 | **ゲストOS**＋アプリケーション＋ライブラリ/依存関係 |
| **サイズ** | 軽量（数MB〜数百MB） | 重量（数GB〜数十GB） |
| **起動速度** | 高速（秒単位） | 低速（分単位） |
| **オーバーヘッド** | 小さい | 大きい |
| **集約度** | 高い（1台のサーバーにより多くを配置可能） | 低い |
| **例えるなら** | **アパートの各部屋**（建物自体は共有） | **独立した一軒家** |
| **代表的な技術** | Docker, Podman | VMware, Hyper-V, VirtualBox, KVM |

一言で言うと、**コンテナは「OSは共有し、アプリ環境だけを分離する軽量な技術」** であり、**仮想マシンは「ハードウェアを仮想化し、OSごと完全に分離する重量級の技術」** です。

---

## 各技術の詳細

![Container vs VM](https://raw.githubusercontent.com/moby/moby/master/docs/img/containers-and-vms.png)
*(出典: Docker Docs)*

### 1. 仮想マシン (Virtual Machine)

仮想マシンは、物理的なコンピュータ（ホストマシン）の上に、「ハイパーバイザー」と呼ばれるソフトウェア層を介して、仮想的なハードウェア（CPU, メモリ, ディスク等）を作り出します。その仮想ハードウェア上に、**ゲストOS**をインストールし、さらにその上でアプリケーションを動作させます。

#### 主な特徴

- **完全な分離**: 各VMは独自のOS（ゲストOS）を持つため、ホストOSや他のVMとは完全に隔離されています。これにより、非常に高いセキュリティレベルを確保できます。
- **異なるOSの実行**: ホストOSがLinuxであっても、Windowsや別のディストリビューションのLinuxなど、異なる種類のOSをゲストとして同時に実行できます。
- **重量級**: OSを丸ごと含むため、イメージサイズが大きく、起動にも時間がかかります。また、リソース消費も大きくなります。
- **レガシーシステムとの親和性**: OSごと環境を再現できるため、特定の古いOSでしか動作しないアプリケーションを動かすのに適しています。

**VMは、異なるOS環境が必要な場合や、セキュリティ要件が非常に厳しい場合に強力な選択肢となります。**

### 2. コンテナ (Container)

コンテナは、ホストマシンのOSカーネルを共有し、その上でアプリケーションとその実行に必要なライブラリや依存関係だけをパッケージ化して分離します。各コンテナは独立したファイルシステム、プロセス空間、ネットワークインターフェースを持ちますが、OS自体は含みません。

#### 主な特徴

- **軽量・高速**: OSを含まないため、イメージサイズは非常に小さく、数秒での高速な起動が可能です。
- **リソース効率**: ホストOSのカーネルを共有するため、VMに比べてCPUやメモリのオーバーヘッドが格段に少なく、1台の物理サーバーにより多くのコンテナを集約できます。
- **高いポータビリティ**: 「一度ビルドすれば、どこでも動く（Build once, run anywhere）」を実現します。開発環境（ローカルPC）で作成したコンテナイメージを、そのままテスト環境や本番環境（オンプレミス、クラウド）で動かすことができます。
- **マイクロサービスとの親和性**: 軽量で独立性が高い特性から、アプリケーションを小さなサービスの集合体として開発する「マイクロサービスアーキテクチャ」と非常に相性が良いです。
- **制約**: ホストOSとカーネルを共有するため、例えばLinuxホスト上でWindowsのコンテナを直接動かすことはできません。

**コンテナは、アプリケーションの開発・デプロイの速度と効率性を劇的に向上させる技術として、クラウドネイティブ時代の中心的な役割を担っています。**

## どちらを選ぶべきか？

- **仮想マシンを選ぶケース**:
    - 異なる種類のOSを1台のサーバーで動かしたい。
    - 高いセキュリティレベルでの分離が必須要件である。
    - OSレベルでのフルコントロールが必要なレガシーアプリケーションを動かす。

- **コンテナを選ぶケース**:
    - 複数のアプリケーションを、リソースを効率的に使いながら同じOS上で動かしたい。
    - 開発から本番まで、一貫した環境で迅速にアプリケーションをデプロイしたい。
    - マイクロサービスアーキテクチャを採用している。
    - スケーラビリティとポータビリティを重視する。

近年では、セキュリティと分離性を高めたコンテナ技術（例: Kata Containers）や、VM上でコンテナを管理する（例: OpenShift Virtualization）など、両者の長所を組み合わせるアプローチも進んでいます。 